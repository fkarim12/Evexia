<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Evexia</title>
    <link rel="stylesheet" href="stylesAll.css" />
    <link rel="stylesheet" href="styleCalTracker.css" />

    <script>
      // Variables to store the data
      var bluePercentage = 50;
      var brownPercentage = 20;
      var redPercentage = 30;

      // Store the variables in localStorage
      localStorage.setItem('bluePercentage', bluePercentage);
      localStorage.setItem('brownPercentage', brownPercentage);
      localStorage.setItem('redPercentage', redPercentage);

      var calGoal = localStorage.getItem('calGoal');
      if (!calGoal) { //if no default
        calGoal = 2000;
      }

      function addCaloriesToTracker(calories) {
        const caloriesCell = document.querySelector('.section.invisible-lines table tr:last-child td:first-child');
        const goalCell = document.querySelector('.section.invisible-lines table tr:last-child td:nth-child(2)');

        const currentCalories = parseInt(caloriesCell.textContent);
        const currentGoal = parseInt(goalCell.textContent);
        const newCalories = currentCalories + calories;

        caloriesCell.textContent = newCalories;
        const net = currentGoal - newCalories;
        document.querySelector('.section.invisible-lines table tr:last-child td:last-child').textContent = net;
      }

      window.addEventListener('message', function(event) {
        const data = event.data;
        if (data && data.meal && data.name && data.calories) {
          const tableId = data.meal + 'Table';
          const table = document.getElementById(tableId);

          const newRow = table.insertRow(-1);
          const cell1 = newRow.insertCell(0);
          const cell2 = newRow.insertCell(1);

          cell1.textContent = data.name;
          cell2.textContent = data.calories + ' cals';

          addCaloriesToTracker(parseInt(data.calories));
        }
      });
    </script>

  </head>

  <body>
    <main>
      <div class="container">
        <h1>Calorie Tracker</h1>
  
        <div class="section invisible-lines" style="background-color: #dcd0ff;">
            <table>
              <tr font-size="20px">
                <th>Calories</th>
                <th>Goal</th>
                <th>Net</th>
              </tr>
              <tr>
              <td>1520</td>
              <td>1800</td>
              <td>-280</td>
              </tr>
            </table>
        </div>
  
        <div class="section" style="background-color: skyblue;">
          <div class="section-title">Breakfast</div>
          <br>
          <table id="BreakfastTable" class="table invisible-lines" style="background-color: skyblue;">
            <tr>
              <td></td>
              <td></td>
            </tr>
          </table>
        </div>

        <div class="section" style="background-color: skyblue;">
          <div class="section-title">Lunch</div>
          <br>
          <table id="LunchTable" class="table invisible-lines" style="background-color: skyblue;">
          </table>
        </div>

        <div class="section" style="background-color: skyblue;">
          <div class="section-title">Dinner</div>
          <br>
          <table id="DinnerTable" class="table invisible-lines" style="background-color: skyblue;">

          </table>
        </div>

        <div class="section" style="background-color: skyblue;">
          <div class="section-title">Snacks</div>
          <br>
          <table id="SnacksTable" class="table invisible-lines" style="background-color: skyblue;">
          </table>
        </div>

        <div class="header1">
          <button class="edit-button" onclick="window.location.href='addFood.html'">Add Food</button>
        </div>
        
      </div>
    </main>

    <nav>
      <ul>
        <a href="./index.html" class="active"><img src="food.jpg" alt="Home" class="nav-icon" /></a>
        <a href="./intakeBreakdown.html"><img src="macronutrients.png" alt="Calorie Intake" class="nav-icon" /></a>
        <a href="./visualizations.html"><img src="visualizations.png" alt="Visualizations" class="nav-icon" /></a>
        <a href="./sleepTracker.html"><img src="sleep.jpg" alt="Sleep Tracker" class="nav-icon" /></a>
        <a href="./userProfile.html"><img src="profile.png" alt="User Profile" class="nav-icon" /></a>
      </ul>
    </nav>

    <script>
      function addFoodEntry(data) {
        if (data && data.meal && data.name && data.calories) {
          const tableId = data.meal + 'Table';
          const table = document.getElementById(tableId);

          const newRow = table.insertRow(-1);
          const cell1 = newRow.insertCell(0);
          const cell2 = newRow.insertCell(1);

          cell1.textContent = data.name;
          cell2.textContent = data.calories + ' cals';

          addCaloriesToTracker(parseInt(data.calories));
        }
      }
    </script>

  </body>
</html>